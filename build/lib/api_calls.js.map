{
  "version": 3,
  "sources": ["../../src/lib/api_calls.ts"],
  "sourcesContent": ["'use strict';\n\nconst baseUrl: string = 'https://umweltbundesamt.api.proxy.bund.dev/api/air_data/v3/';\n//\nimport { promises as fs } from 'fs';\n//\ninterface Logger {\n\tpath: string;\n\tfile: string;\n}\nconst fileHandle = { path: './logs/airquality', file: 'logs.txt' };\n\n/**\n * Read in all active measuring stations\n * @returns {Stations} _stations\n */\nexport async function getStations(): Promise<Stations> {\n\t//url_Stations: 'https://umweltbundesamt.api.proxy.bund.dev/api/air_data/v3/stations/json?lang=de';\n\t//const url: string = baseUrl + 'stations/json?lang=de';\n\tconst urlStation: string = await prepareQueryParameters('');\n\tconst url = [baseUrl, 'stations/json?use=airquality&lang', urlStation].join('');\n\tconst _stations: Stations = {};\n\treturn fetch(url, {\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\taccept: 'application/json',\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'User-Agent':\n\t\t\t\t'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36',\n\t\t},\n\t}).then(async (response) => {\n\t\tif (!response.ok) throw new Error('[getStations] failed to retrieve data');\n\t\tconst data: any = await response.json();\n\t\tfor (const key in data.data) {\n\t\t\tconst stationId: number = data.data[key][0];\n\t\t\t//const network: string = data.data[key][12];\n\t\t\t//await writeLog(fileHandle, JSON.stringify(data.data[key]));\n\t\t\t//\n\t\t\t/*\n\t\t\tif (network == 'BE') {\n\t\t\t\t//await writeLog(fileHandle, String(stationId) + '#' + data.data[key][1]);\n\t\t\t\tawait writeLog(fileHandle, JSON.stringify(data.data[key]));\n\t\t\t}\n\t\t\t*/\n\t\t\t//\n\t\t\t_stations[stationId] = {\n\t\t\t\tid: data.data[key][0],\n\t\t\t\tcode: data.data[key][1],\n\t\t\t\tcity: data.data[key][3],\n\t\t\t\tnetwork: data.data[key][12],\n\t\t\t\tstreet: data.data[key][17],\n\t\t\t\tnumber: data.data[key][18],\n\t\t\t\tzipcode: data.data[key][19],\n\t\t\t\tlon: data.data[key][7],\n\t\t\t\tlat: data.data[key][8],\n\t\t\t\t//\n\t\t\t};\n\t\t}\n\t\treturn _stations;\n\t});\n}\n\n/**\n * Read in all components\n * @returns {Components} _components\n */\nexport async function getComponents(): Promise<Components> {\n\t//url_Components: 'https://umweltbundesamt.api.proxy.bund.dev/api/air_data/v3/components/json?lang=de&index=id';\n\tconst url: string = baseUrl + 'components/json?lang=de&index=id';\n\tconst _components: Components = {};\n\treturn fetch(url, {\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\taccept: 'application/json',\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'User-Agent':\n\t\t\t\t'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36',\n\t\t},\n\t}).then(async (response) => {\n\t\tif (!response.ok) throw new Error('[getComponents] failed to retrieve data');\n\t\tconst data: any = await response.json();\n\t\tfor (const key in data) {\n\t\t\tif (!isNaN(parseInt(key))) {\n\t\t\t\t// Measurement types from the numerical lists\n\t\t\t\t_components[key] = { name: data[key][1], unit: data[key][3], desc: data[key][4] };\n\t\t\t}\n\t\t}\n\t\treturn _components;\n\t});\n}\n\n/**\n * Read in all measurements\n * @param {string} stationCode\n * @returns {*} _measurements\n */\nexport async function getMeasurements(stationCode: string): Promise<any> {\n\t//url_Measurements: 'https://umweltbundesamt.api.proxy.bund.dev/api/air_data/v3/airquality/json?date_from=2024-09-11&time_from=14&date_to=2024-09-11&time_to=14&station=DENW430&lang=de'\n\tconst urlSpec: string = 'airquality/json?';\n\tconst urlStation: string = await prepareQueryParameters(stationCode);\n\tconst url = [baseUrl, urlSpec, urlStation].join('');\n\tlet _measurements: any = {};\n\treturn fetch(url, {\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\taccept: 'application/json',\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'User-Agent':\n\t\t\t\t'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36',\n\t\t},\n\t}).then(async (response) => {\n\t\tif (!response.ok) throw new Error('[getMeasurements] failed to retrieve data');\n\t\tconst data: any = await response.json();\n\t\t_measurements = data.data;\n\t\treturn _measurements;\n\t});\n}\n\n/**\n * Reading in measurements for a specified component\n * @param {string} stationCode\n * @param {number} component\n * @returns {*} _measurements\n */\nexport async function getMeasurementsComp(stationCode: string, component: number): Promise<any> {\n\t//https://www.umweltbundesamt.de/api/air_data/v3/measures/json?date_from=2024-11-29&date_to=2024-11-29&time_from=7&time_to=8&station=DEHE018&component=2\n\tconst urlSpec: string = 'measures/json?';\n\tconst urlStation: string = await prepareQueryParameters(stationCode);\n\tconst url = [baseUrl, urlSpec, urlStation, '&component=', component].join('');\n\tlet _measurements: any = {};\n\treturn fetch(url, {\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\taccept: 'application/json',\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'User-Agent':\n\t\t\t\t'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36',\n\t\t},\n\t}).then(async (response) => {\n\t\tif (!response.ok) throw new Error('[getMeasurements] failed to retrieve data');\n\t\tconst data: any = await response.json();\n\t\t_measurements = data.data;\n\t\treturn _measurements;\n\t});\n}\n\n//\n/**\n * prepareQueryParameters\n * @param {string} stationCode\n * @returns {string} preparedQueryParameter\n */\nasync function prepareQueryParameters(stationCode: string): Promise<string> {\n\tconst parameters = [];\n\tconst workDate = getDateUTC();\n\tconst _hour = workDate.getHours();\n\tconst _hourFrom = _hour < 1 ? 24 : _hour;\n\t//const _hourFrom1 = _hourFrom - 1;\n\t//const _hourTo = _hourFrom + 1;\n\t//\n\tconst dateFrom = 'date_from=' + formatDate(workDate);\n\tparameters.push(dateFrom);\n\t//\n\tconst timeFrom = 'time_from=' + String(_hourFrom);\n\tparameters.push(timeFrom);\n\t//\n\tconst dateTo = 'date_to=' + formatDate(workDate);\n\tparameters.push(dateTo);\n\t//\n\tconst timeTo = 'time_to=' + String(_hourFrom); //_hourTo\n\tparameters.push(timeTo);\n\t//\n\tif (stationCode != '') {\n\t\tparameters.push('station=' + stationCode);\n\t\tparameters.push('lang=de');\n\t}\n\t//\n\tconst preparedQueryParameter = parameters.join('&');\n\t//console.log(`Parameter: ${preparedQueryParameter}`);\n\treturn preparedQueryParameter;\n}\n/**\n * getDateUTC\n * @returns {Date} aktual date in UTC\n */\nfunction getDateUTC(): Date {\n\tconst d = new Date();\n\treturn new Date(\n\t\td.getUTCFullYear(),\n\t\td.getUTCMonth(),\n\t\td.getUTCDate(),\n\t\td.getUTCHours(),\n\t\td.getUTCMinutes(),\n\t\td.getUTCSeconds(),\n\t);\n}\n/**\n * formatDate\n * @param {Date} d Input Date\n * @returns {string} formatted data-string\n */\nfunction formatDate(d: Date): string {\n\tconst year = d.getFullYear();\n\tconst month = (d.getMonth() + 1).toString().padStart(2, '0');\n\tconst day = d.getDate().toString().padStart(2, '0');\n\treturn `${year}-${month}-${day}`;\n}\n\nasync function writeLog(fileObj: Logger, logEntry: string): Promise<void> {\n\t// Get the current date and time\n\tconst now = new Date();\n\tconst dateTime = now.toLocaleString('fr-CH'); // best format for log-entrys\n\t// Format the log entry\n\tconst data = `${dateTime}\\t${logEntry}\\n`;\n\tappendDataToFile(fileObj, data);\n}\n\nasync function appendDataToFile(fileObj: Logger, data: string): Promise<void> {\n\t//console.log(`(f) checkDirectory ${JSON.stringify(fileObj)}`);\n\tif (!fileObj.path.endsWith('/')) {\n\t\tfileObj.path += '/';\n\t\t//console.log(`\"/\" wurde an ${fileObj.path} angef\u00FCgt.`);\n\t}\n\t//\n\ttry {\n\t\t// \u00DCberpr\u00FCfen und Verzeichnis erstellen, falls es nicht existiert\n\t\tawait fs.mkdir(fileObj.path, { recursive: true });\n\t\t// Daten an die Datei anh\u00E4ngen\n\t\t//const filename = fileObj.path + dynFilename(fileObj); //fileObj.file;\n\t\tconst filename = fileObj.path + fileObj.file;\n\t\t//console.log(`Filename: ${filename}`);\n\t\tawait fs.appendFile(filename, data);\n\t\tconsole.log(`Daten wurden erfolgreich an die Datei ${filename} angeh\u00E4ngt.`);\n\t} catch (error: any) {\n\t\tif (error.code === 'EACCES') {\n\t\t\tconsole.log('Zugriffsfehler: Sie haben keine Berechtigung zum Anh\u00E4ngen von Daten an die Datei.');\n\t\t} else if (error.code === 'ENOENT') {\n\t\t\tconsole.log('Datei oder Verzeichnis nicht gefunden: ' + error.path);\n\t\t} else if (error.code === 'ENOTDIR') {\n\t\t\tconsole.log('Pfad ist kein Verzeichnis: ' + error.path);\n\t\t} else {\n\t\t\tconsole.log('Ein unbekannter Fehler ist aufgetreten:');\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": ["fs"]
}
